<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'/>

    <meta name="description" content="Knockout CRUD">
    <meta name="author" content="Slavko">
    <link rel="icon" href="favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <meta http-equiv="PRAGMA" content="NO-CACHE" />

    <title>Admin Module</title>
  
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.css" rel="stylesheet" type="text/css" />

    <link href="css/font-awesome.css" rel="stylesheet" type="text/css" />
    <link href="css/SLGrid.css" rel="stylesheet" type="text/css" />

    <!-- Custom styles for this template -->
    <link href="css/dashboard.css" rel="stylesheet" />

    <style type="text/css">
        @import url(//fonts.googleapis.com/css?family=Kaushan+Script);
        .navbar-brand 
        {
            font-size: 20px;
            font-family: 'Kaushan Script', cursive;
        }
    </style>

    <style type="text/css">
        body { font-family: 'Source Sans Pro', sans-serif; }
        td { padding:10px;  vertical-align:text-top; }
    </style>

    <style type="text/css">
        tr.positive > td > span[data-field='Actual'] { color:rgb(40, 149, 0) }
        tr.negative > td > span[data-field='Actual'] { color:rgb(209, 40, 40) }
        tr.positive > td > span[data-field='Diff'] { color:rgb(40, 149, 0) }
        tr.negative > td > span[data-field='Diff'] { color:rgb(209, 40, 40) }
    </style>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/knockout.mapping/2.4.1/knockout.mapping.js"></script>

    <script src="SLGridALL.js" type="text/javascript"></script>
    <script src="MyAppALL.js" type="text/javascript"></script>

 
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>
    <script src="js/docs.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript">
        function Trace(obj) {
            if (window.console && window.console.log)
                window.console.log(obj.toString());
        }
    </script>

  </head>

  <body>

 <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">KnockoutCRUD </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#">Dashboard</a></li>
            <li><a href="#">Settings</a></li>
            <li><a href="#">Profile</a></li>
            <li><a href="#">Help</a></li>
          </ul>
          <form class="navbar-form navbar-right">
            <input type="text" class="form-control" placeholder="Search...">
          </form>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">

        <div class="col-sm-3 col-md-2 sidebar">
           
          <div class="well"> 
          <ul class="nav nav-sidebar">
            <li id="Overview" class="active"><a href="#">Overview</a></li>
            <li id="AdminModule"><a href="#">Admin Module</a></li>
          </ul>
          </div>

          <div class="well"> 
           <i>Steps</i>
          <ul class="nav nav-sidebar">
            <li id="Person"><a href="#">Person</a></li>
            <li id="PersonList"><a href="#">PersonList</a></li>
            <li id="PersonDB"><a href="#">PersonDB</a></li>
            <li id="ViewModels"><a href="#">View Models</a></li>
            <li id="EntityListTemplates"><a href="#">List templates</a></li>
            <li id="Bindings"><a href="#">Bindings</a></li>
          </ul>
          </div>

          <div class="well"> 
          <i>Features</i>
          <ul class="nav nav-sidebar">
            <li id="Widgets"><a href="#">Widgets</a></li>
            <li id="Relations"><a href="#">1:N Relations</a></li>
          </ul>
          </div>
        </div>

        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <h2 class="page-header">SLGrid - Knockout jQuery component</h2>

          <div class="row placeholders">
            <div class="col-xs-6 col-sm-3 placeholder">
              <img data-src="holder.js/40x40/auto/sky" class="img-responsive" alt="Generic placeholder thumbnail">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder">
              <img data-src="holder.js/40x40/auto/vine" class="img-responsive" alt="Generic placeholder thumbnail">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder">
              <img data-src="holder.js/40x40/auto/sky" class="img-responsive" alt="Generic placeholder thumbnail">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder">
              <img data-src="holder.js/40x40/auto/vine" class="img-responsive" alt="Generic placeholder thumbnail">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div>
          </div>

          <!--<h2 class="sub-header">Section</h2>-->
          <div class="table-responsive">

            <div id="OverviewPanel" class="entity-panel" style="display:none;">

                Core component is <i><b>SLGrid</b></i>, developed as jQuery Knockout Widget using custom bindings. It is jQuery client component that can be used in any evironment. 
                <br /><br />
                SLGrid features:
                <ul>
                <li>Works with any Database</li>
                <li>Used in any of evironments like: Java, .NET, ...</li>
                <li>Standard grid features: Pagination, Search, Sort ...</li>
                <li>Each cell can host Knockout widget (dropdown, typeahead, date picker, ...) for presentation of field value</li>
                <li>Each row has expanding panel presenting detail information or the children objects of the row</li>
                </ul>
                
                SLGrid uses Knockout which does declarative bindings connecting parts of UI to data model.<br /> 
                The same entity model (document) can be presented (bound) in many views like: 
                <ul>
                <li>Row view</li>
                <li>Row edit view</li>
                <li>Form view</li>
                <li>Form edit view</li>
                <li>...</li>
                </ul>
                
                <br />
                Here is the sample of the usage of SLGrid component.<br />
                We can see advantages of Knockout widgets used in cells of SLGrid.
                <br />
                <br />

                <div class="well" style="width:70%" >
                    <div class="entity-list indizes-list" style="width:100%" 
                            data-bind="template: { 
                                        name: 'EntityListTemplate',
                                        data : indizeList, 
                                        afterRender: indizeList.afterRender }" >
                    </div>
                </div>

                <br/>
                <a href="http://jsfiddle.net/SlavkoPar/04pjL8Lh/" target="_blank">Try on JSFiddle</a>
               <br/>
                <br/>

                <h2>Steps of usage of SLGrid</h2>
                <br/>
                <h4>1) Define classes Indize, IndizeList, IndizeDB (SLGen can generate classes from DB definition)</h4>

    <b><i>Indize</i></b>
    <pre><code class="javascript">
     function Indize (data, gridViewModel) {
        var self = this;
        this.gridViewModel = gridViewModel; // the same as IndizeList.viewModel

        this.IndizeId = ko.observable(data.IndizeId || 0)
        this.Title = ko.observable(data.Title || "")

        this.Actual = ko.observable(data.Actual || 0)
        this.actualPrevious = data.Actual || 0
        this.actualStatus = ko.computed(function () {
            var delta = this.Actual() - this.actualPrevious;
            this.actualPrevious = this.Actual();
            return delta;
        }, this);

        this.Diff = ko.observable(data.Diff || 0)
    }

    Indize.prototype = new SLEntity();

    Indize.prototype.IndizeId = ko.observable(0)
        .extend({
            primaryKey: true,
            width: "100px",
            defaultValue: function () { return this.getNextId() }
        });

    Indize.prototype.Title = ko.observable("")
        .extend({
            headerText: "Title",
            formLabel: "Title",
            presentation: "bsPopoverLink", // view form
            width: "200px",
            defaultValue: "",
            required: true,
            minLength: 20,
            pattern: { message: 'Please, start with uppercase !', params: '^([A-Z])+' }
        });

    Indize.prototype.Actual = ko.observable(0)
        .extend({
            headerText: "Actual",
            formLabel: "Actual",
            width: "auto", // one of the columns with take rest of row space
            defaultValue: 0,
            presentation: "bsMoney",
            align : 'right'
        });

    Indize.prototype.actualStatus = ko.observable("")
        .extend({
            headerText: "",
            formLabel: "",
            width: "20px",
            sortable: false,
            defaultValue: "",
            presentation: "bsArrowUpDown",
            align: "center"
        });

    Indize.prototype.Diff = ko.observable(0)
        .extend({
            headerText: "Diff. (%)",
            formLabel: "Diff. (%)",
            width: "70px", // one of the columns with take rest of row space
            defaultValue: 0,
            //presentation: "bsMoney",
            sortable:false,
            align: 'right'
        });

    
    Indize.prototype.editRow = ko.observable("")
        .extend({
            headerText: "",  //"Edit"
            sortable: false,
            width: "30px",
            presentation: "bsRowEditLink"
        });

    Indize.prototype.deleteRow = ko.observable("")
        .extend({
            headerText: "", // "Delete"
            sortable: false,
            width: "30px",
            presentation: "bsRowDeleteLink"
        });

</code></pre>

<b><i>IndizeList</i></b>
<pre><code class="javascript">
var <big><b>IndizeList</b></big> = (function (DB) {
    var db = DB,
        PageSize = 10,
        Page = 1,
        Filter = "",
        OrderByColumn = "Title",
        Asc = true;

    var Subscribe = function (page, size) {
        var query = {
            filter: Filter || "",
            page: page || Page,
            pageSize: size || PageSize,
            orderBy: OrderByColumn,
            asc: Asc
        };
        db.Subscribe(query, PushInitialSet);
    }

    var PushInitialSet = function (set, maxPageIndex, nItems) {
        ko.mapping.fromJS(set, {
            key: function (indize) {
                return ko.utils.unwrapObservable(indize.IndizeId);
            },
            create: function (options) {
                return new Indize(options.data, gridViewModel);
            }
        }, gridViewModel.itemsAtPage);
        gridViewModel.nItems(nItems);
        gridViewModel.maxPageIndex(maxPageIndex);
    }

    var PushUpdates = function () { }

    var GetDB = function () { return db; }

    var GetIndize = function (id) { return db.GetIndize(id); }
    var StoreIndize = function (data) { db.StoreIndize(data) }
    var UpdateIndize = function (data) { db.UpdateIndize(data) }
    var DeleteIndize = function (indize) { db.DeleteIndize(indize) }

    var GetNextId = function () { return db.GetMaxId() + 1; }

    function GridViewModel() {
        var self = this;

        this.Subscribe = function (page, size) {
            Subscribe(page, size);
        }

        this.getItem = function (id) {
            return ko.utils.arrayFirst(ViewModel.itemsAtPage(), function (p) { // grep
                return p.IndizeId() == id;
            });
        }

        this.update = function (indize) {  UpdateIndize(indize); }
        this.store = function (indize) {   StoreIndize(indize);  }
        this.remove = function (indize) {  DeleteIndize(indize); }

        this.afterRender = function (elems, z) {
            setTimeout(function () { db.pushChange() }, 1000)
        }

        this.afterRenderTR = function (elems, ent) { }

        this.canAdd = ko.computed(function () {
            return this.itemsAtPage().length < PageSize + 1;
        }, this)

        this.add = function () {
            var data = Indize.prototype.defaultData(this);
            data = $.extend({}, data, { isNew: true }) // , isRowEdit: true
            this.isAdding(true);
            var indize = ko.mapping.fromJS(data, {
                key: function (indize) {
                    return ko.utils.unwrapObservable(indize.IndizeId);
                },
                create: function (options) {
                    return new Indize(options.data, self); // self is gridViewModel
                }
            });
            this.itemsAtPage.push(indize);
        }

    } // end of GridViewModel

    GridViewModel.prototype = new SLGridViewModel({
        orderByColumn: OrderByColumn,
        columns: Indize.prototype.getGridColumns(OrderByColumn)
    })

    var gridViewModel = new GridViewModel();

    return {
        viewModel: gridViewModel,
        indizeDB: db
    }

})(new IndizeDB());

</code></pre>

<b><i>IndizeDB</i></b>
<pre><code class="javascript">
function IndizeDB() {
    var self = this;

    this.Items = [
            { IndizeId: 1, Title: "DAX", Actual: 9578.60, Diff: -0.31 },
            { IndizeId: 2, Title: "TECDAX", Actual: 1229.06, Diff: 0.21 },
            { IndizeId: 3, Title: "FTSE 100", Actual: 6662.10, Diff: -0.20},
            { IndizeId: 4, Title: "CAC 40", Actual: 4368.68, Diff: 0},
            { IndizeId: 5, Title: "Nasdaq 100", Actual: 4103.083, Diff: 0.72},
            { IndizeId: 6, Title: "S&P 500", Actual: 2011.36, Diff: 0.49},
            { IndizeId: 7, Title: "EuroStoxx 50", Actual: 3208.76, Diff: 0.08},
            { IndizeId: 8, Title: "Nikkei 225", Actual: 16321.17, Diff: 1.58},
            { IndizeId: 9, Title: "Hang Seng", Actual: 24377.05, Diff: 0.86},
            { IndizeId: 10, Title: "ASX", Actual: 5437.30, Diff: 0.34 }
        ];

    this.Subscribe = function (query, callBack) {
            this.ItemsFiltered = this.Items;
            this.Start = (query.page - 1) * query.pageSize;
            this.End = this.Start + query.pageSize;
            this.MaxPageIndex = Math.ceil(this.ItemsFiltered.length / query.pageSize) - 1;
            this.SortBy(query.orderBy, query.asc);
            var set = this.ItemsFiltered.slice(this.Start, this.End);
            callBack(set, this.MaxPageIndex, this.ItemsFiltered.length)
    }

    this.pushChange = function () {
        var neg = Math.round(Math.random() * 1);
        var percent = Math.random() * 10;
        if (neg == 0)
            percent = -percent;
        var i = Math.floor(Math.random() * (IndizeList.viewModel.itemsAtPage().length));
        var item = IndizeList.viewModel.itemsAtPage()[i];
        var delta = (item.Actual() / 100) * percent;
        item.Diff(percent.toFixed(1));
        item.Actual(item.Actual() + delta); //(neg == 0 ? -delta : delta))
        setTimeout(function () { self.pushChange() }, 100)
    }

    this.GetMaxId = function () {
        var arr = this.Items.map(function (data, i) { return data.IndizeId; });
        return Math.max.apply(null, arr);
    }

    this.GetIndize = function (indizeId) {
        return ko.utils.arrayFirst(this.Items, function (p) {
            return p.IndizeId == indizeId;
        });
        return null;
    }

    this.UpdateIndize = function (data) {
        var indize = this.GetIndize(data.IndizeId);
        $.each(indize, function (name, value) {
            indize[name] = data[name];
        });
    }

    this.StoreIndize = function (data) {
        this.Items.push(data)
    }

    this.DeleteIndize = function (entity) {
        var data = this.GetIndize(entity.IndizeId());
        this.Items.splice($.inArray(data, this.Items), 1);
        setTimeout(function () { entity.onDeleted("ok", "deleted") }, 100);
    }

};

IndizeDB.prototype = new DBEntity();
</code></pre>

<b><i>Knockout widget: bsMoney</i></b>
<pre><code class="javascript">
    ko.bindingHandlers.bsMoney = {
        update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
            var value = ko.utils.unwrapObservable(valueAccessor())
            var mode = viewModel.rowDisplayMode()
            var inRow = allBindings.get("inRow");
            var isViewMode = inRow && viewModel.isRowViewMode() || !inRow && viewModel.isViewMode()

            if (isViewMode) {
                var tokens = value.toFixed(2).replace('-', '').split('.');
                var s = '$' + $.map(tokens[0].split('').reverse(), function (elm, i) {
                    return [(i % 3 === 0 && i &gt; 0 ? ',' : ''), elm];
                }).reverse().join('') + '.' + tokens[1];
                var markup = value &lt; 0 ? '-' + s : s;
                $(element).html(markup)
            }
            else {
                if ($(element).find('input').length == 0) {
                    var colName = $(element).data("field");
                    $(element).html("&lt;input style='text-align:right' class='form-control' 
                                data-field='" + colName + "' 
                                data-bind=\"value: " + colName + "().toFixed(2), valueUpdate:'keyup'\"&gt;")
                }
            }
        }
    }

    </code></pre>

<h4>2) Add view model to global view model </h4>
<pre><code class="javascript">
        var globalViewModel = {
            ...
            indizeList: IndizeList.viewModel
        }

        $(document).ready(function () {
            ko.applyBindings(globalViewModel);
        });

</code></pre>
<br />
<h4>3) Create Indize list template, or default <b><i>EntityListTemplate</i></b>  will be used </h4>
<pre><code class="html"> 
&lt; script type="text/html" id="EntityListTemplate"&gt;
        &lt;div style="float:left"&gt;
            &lt;h4 data-bind="text:listHeader"&gt;&lt;/h4&gt; 
        &lt;/div&gt;

        &lt;div style="clear:both"&gt;&lt;/div&gt;

        &lt;div style="width:100%"&gt; 
            &lt;div data-bind="SLGrid: $data" /&gt; 
            &lt;div&gt;
                &lt;div style="float:left"&gt;
                    &lt;button class="btn btn-primary btn-xs" 
                        data-bind="click: add, enable: canAdd, text:textAdd"&gt;&lt;/button&gt;
                &lt;/div&gt;
                &lt;div style="float:right;" data-bind="SLGridPager: $data"&gt;
                &lt;/div&gt;
                &lt;div style="float:right; margin-right:20px;"&gt;
                    &lt;span data-bind='text: nItems'&gt;&lt;/span&gt; &lt;span data-bind='text:textPager'&gt;&lt;/span&gt;
                    &lt;span data-bind="visible:maxPageIndex()&gt;=itemsOnPager()"&gt;, 
                    &lt;span data-bind='text:maxPageIndex()+1'&gt;&lt;/span&gt; pages&lt;/span&gt;
                &lt;/div&gt;
                &lt;div style="clear:both"&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/script&gt;
</code></pre>
<br />
<h4>4) Bind IndizeTemplate to IndizeList.viewModel  </h4>
<pre><code class="html"> 
    &lt;div class="entity-list indizes-list" style="width:50%" 
            data-bind="template: { 
                        name: 'EntityListTemplate',
                        data : indizeList, 
                        afterRender: indizeList.afterRender }" &gt;
    &lt;/div&gt;
</code></pre>

            </div>
  

            <div id="AdminModulePanel" class="entity-panel" style="display:none;">
                <h3>Here is the sample of usage of SLGrid for <i><b>Admin Module</b></i> of Web Site</h3>
                <ul>
                    <li>
                    Provide Database Definition
                    <a href="SLGen.htm"> <i><b>Sample Database definition</b></i></a>
                    </li>
                    <li>
                        Run the Generator to create JavaScript classes, HTML Templates, Knockout widgets ...
                    </li>
                    <li>
                        <a href="KnockoutCRUD.htm"><i><b>Admin module</b></i></a> after generation. 
                    </li>
                </ul>
                 
                <br/>

                Generator reads definitions of Tables and Fields, and generates javascript classes (js files).<br/>
                It uses relation established between tables, and generates appropriate JavaScript code: 
                    <ul>
                    <li>js classes</li>
                    <li>HTML templates</li>
                    <li>Knockout widgets: dropdowns, typeaheads, date pickers ...</li>
                    <li>Expanding panels for 1:N relations beetween entities (tables)</li>
                    </ul>
                
                <br/>
                Each cell of SLGrid can host Knockout widget like dropdown, typeahead, date picker ...<br/>
                It easily to create Knockout widget and itegrate it with SLGrid.
                <br/>
                <br/>
                Generated JavaScript code can be easily extended with additional functionality and business logic.</br>
                Business logic can be complex, and users prefer custom events where they can write their custom code.</br>
                That way whole js code is in appropriate classes, and there is no JavaScript code at page (global) level.</br></br>
                Generator will keep user changes upon modification of Database Definition and regeneration of classes.</br></br>

                The core component is Knockout SLGrid which can host Knockout Widget in each cell column.</br>
                See feature: "Widgets".
                That way each table field can have its own presentation.

                <h2>Steps</h2>
                <br/>
                <ul>

                <li>
                    Generator will generate  <b>YourEntity</b> JavaScript classes based on template classes:<br/><br/>
                    &nbsp;&nbsp;&nbsp;Person.js => <b>YourEntity</b>.js<br/>
                    &nbsp;&nbsp;&nbsp;PersonList.js => <b>YourEntityList</b>.js<br/>
                    &nbsp;&nbsp;&nbsp;PersonDB.js => <b>YourEntityDB.js</b><br/><br/>
                </li>

                <li>
                    Add ViewModel to globalViewModel <br />
                    <pre><code class="javascript"> 
                    var globalViewModel = {
                        ...
                        yourEntityList: YourEntityList.viewModel
                    }
                </code></pre> 
                <br/>
                </li>

                <li>
                Optionally define <b><i>YouEntityList</i></b> template. Otherwise default <i>"EntityListTemplate"</i> will be used.
                <br />
                <br/>
                </li>

                <li>
                    Bind YourEntityTemplate to YourEntityList.viewModel
                <pre><code class="html"> 
                    &lt;div class="entity-list your-entity-list" style="width:80%" 
                        data-bind="template: {  name: 'EntityListTemplate',  
                                                data : yourEntityList, 
                                                afterRender: yourEntityList.afterRender }" &gt;
                    &lt;/div&gt;
                </code></pre>  
                </li>

                </ul>
            </div>

            <div id="PersonPanel" class="entity-panel" style="display:none;">
                <pre><code class="lang-javascript">    
                var <b>Person</b> = function () {
                    this.PersonId = ko.observable(data.PersonId || 0)
                    this.Name = ko.observable(data.Name || "")

                    this.TwitterName = 
                             ko.observable(data.TwitterName || "")
                    ...
                }

                Person.prototype.PersonId = ko.observable(0)
                    .extend({
                        primaryKey: true,
                        headerText: "Id",
                        formLabel: "Id",
                        width: "100px",
                        defaultValue: function () { 
                                         return this.getNextId() 
                                      }
                    });
                ...

                Person.prototype.chosenCity = ko.observable()
                        .extend({
                            headerText: "City",
                            formLabel: "City",
                            width: "200px",
                            //presentation: "bsDropDownCity"
                            presentation: <b style='color:maroon'>"bsTypeaheadCity"</b>
                        });
                ...
                </code></pre>   
            </div>

            <div id="PersonListPanel" class="entity-panel" style="display:none;">
                Hosts ViewModel for Person list. <br/>
                Uses module pattern to overcome the limitations of the object literal,<br/> 
                offering privacy for variables and functions while exposing a public API.<br/>
                <br/>
                <pre><code class="lang-javascript"> 
                var <b>PersonList</b> = (function (DB) {
                  var db = DB;

                  var StorePerson  = function (data) { 
                    db.StorePerson(data) 
                  }

                  var UpdatePerson = function (data) { 
                    db.UpdatePerson(data) 
                  }

                  var DeletePerson = function (personId) { 
                    db.DeletePerson(personId) 
                  }

                  function GridViewModel() {
                    ...
                    this.canAdd = ko.computed(function () {
                        return this.itemsAtPage().length < PageSize + 1;
                    }, this)

                    this.add = function () {
                    }
                    ...
                  }
                  GridViewModel.prototype = new SLGridViewModel();

                  var gridViewModel = new GridViewModel();
                  return {
                        viewModel: gridViewModel
                  }

                })(new PersonDB());    
                </code></pre>     
            </div>

            <div id="PersonDBPanel" class="entity-panel" style="display:none;">
                Work with Database (storage)<br/>
                Adapter can be:
                <ul>
                    <li>in-memory</li>
                    <li>ajax based</li>
                    <li>LightStreamer pusher</li>
                    <li>any custom adapter for specific DB</li>
                    </ul>
                <br />        

                <pre><code class="lang-javascript"> 
                function <b>PersonDB()</b> {

                  this.UpdatePerson = function (data) {
                    ...
                  }

                  this.StorePerson = function (data) {
                    ...
                  }

                  this.DeletePerson = function (id) {
                    ...
                  }
                }   
                PersonDB.prototype = new DBEntity(); 
                </code></pre>    
            </div>

            <div id="ViewModelsPanel" class="entity-panel" style="display:none;">
                ViewModels of all the entities are being used in global ViewModel like this: <br />
                <pre><code class="javascript"> 
                    var globalViewModel = {
                        personList: PersonList.viewModel,
                        cityList: CityList.viewModel,
                        categoryList: CategoryList.viewModel
                    }

                    $(document).ready(function () {
                        ko.applyBindings(globalViewModel);
                    });
                </code></pre>     
            </div>

            <div id="EntityListTemplatesPanel" class="entity-panel" style="display:none;">
                Here is the example of <b><i>PersonList</i></b> template.<br />
                As in all other cases, if you provide custom template it will be used.<br />
                Otherwise default <b><i>EntityListTemplate</i></b> will be used.
                <br />

                <pre><code class="html"> 
                &lt; script type="text/html" id="PersonList"&gt;
                        &lt;div style="float:left"&gt;
                             &lt;h4&gt;Team&lt;/h4&gt; 
                        &lt;/div&gt;

                        &lt;div class="form-group" style="float:left;margin:5px;width:200px !important;margin-left:50px;"&gt;
                            &lt;div class="input-group iiinput-group-sm"&gt;
                                &lt;input id="filterPersonList" type="text" class="form-control input-sm typeahead" style="padding:2px 6px;" /&gt;
                                &lt;span class="input-group-addon" style="padding:2px 6px;"&gt;
                                    &lt;i id='icon-typeahead' class="fa fa-filter" style="font-size:14px;"&gt;&lt;/i&gt;
                                &lt;/span&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;

                        &lt;div style="clear:both"&gt;&lt;/div&gt;

                        &lt;div style="width:100%"&gt; 
                            &lt;div data-bind="SLGrid: $data" /&gt;
                            &lt;div&gt;
                                &lt;div style="float:left"&gt; 
                                    &lt;button class="btn btn-primary" 
                                        data-bind="click: addPerson, enable: canAddPerson"&gt;Add Person&lt;/button&gt;
                                &lt;/div&gt;
                                &lt;div style="float:right;" data-bind="SLGridPager: $data"&gt;
                                &lt;/div&gt;
                                &lt;div style="float:right; margin-right:20px;"&gt;
                                    &lt;span data-bind='text: nItems'&gt;&lt;/span&gt; people&lt;span 
                                        data-bind="visible:maxPageIndex()&gt;=itemsOnPager()"&gt;, 
                                        &lt;span data-bind='text:maxPageIndex()+1'&gt;&lt;/span&gt; pages&lt;/span&gt;
                                &lt;/div&gt;
                                &lt;div style="clear:both"&gt;&lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/script&gt;
                </code></pre>  
            </div>

            <div id="BindingsPanel" class="entity-panel" style="display:none;">
                Bind PersonTemplate to PersonList.viewModel

                <pre><code class="html"> 
                    &lt;div class="entity-list person-list" style="width:80%" 
                        data-bind="template: {  name: 'PersonList',  
                                                data : personList, 
                                                afterRender: personList.afterRender }" &gt;
                    &lt;/div&gt;
                </code></pre>  
            </div>


            <div id="WidgetsPanel" class="entity-panel" style="display:none;">
                We use widgets created by Knockout Custom Bindings.<br/>
                Each field can be presented in table row, or in Bootstrap form (popover) by different widget.<br/>
                See above mentioned widgets: bsDropDownCity or bsTypeheadCity.

                <pre><code class="javascript"> 
                ko.bindingHandlers.bsStatus = {
                    update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                        var value = ko.utils.unwrapObservable(valueAccessor())
                        var mode = viewModel.rowDisplayMode()
                        var inRow = allBindings.get("inRow");
                        var isViewMode = inRow && viewModel.isRowViewMode() || !inRow && viewModel.isViewMode()
                        var markup = /*isViewMode ?*/
                            (value == 1 ? "<span class='badge alert-success'>Success</span>" : "<span class='badge alert-danger'>Failure</span>")

                        $(element).html(markup)
                    }
                }
                </code></pre>  
                That widget can be used like this<br/>
                <pre><code class="javascript"> 
                    BlogPost.prototype.status = ko.observable("")
                        .extend({
                            headerText: "Status",
                            formLabel: "Status",
                            presentation: "bsStatus",
                            width: "30px"
                        });
                </code></pre>  
            </div>

            <div id="RelationsPanel" class="entity-panel" style="display:none;">
                Generator delivers UI (HTML and JavaScript code) for presentation of 1:N relations taken from Database Definition.
                <br /><br />
                For example: <br />
                <ul>
                    <li>Person has Posts<br /><img src="Images/PersonPosts.png" /></li>
                    <li style='margin-top:5px;'>Category has Posts<br /><img src="Images/CategoryPosts.png" /></li>
                </ul>
                 
            </div>

          </div>
        </div>
      </div>
    </div>


<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/default.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>


    <script type="text/html" id="EntityListTemplate">
        <div style="float:left">
             <h4 data-bind="text:listHeader"></h4> 
        </div>

        <div style="clear:both"></div>

        <div style="width:100%"> 
            <div data-bind="SLGrid: $data" /> 
            <div>
                <div style="float:left">
                    <button class="btn btn-primary btn-xs" data-bind="click: add, enable: canAdd, text:textAdd"></button>
                </div>
                <div style="float:right;" data-bind="SLGridPager: $data">
                </div>
                <div style="float:right; margin-right:20px;">
                    <span data-bind='text: nItems'></span> <span data-bind='text:textPager'></span><span data-bind="visible:maxPageIndex()>=itemsOnPager()">, <span data-bind='text:maxPageIndex()+1'></span> pages</span>
                </div>
                <div style="clear:both"></div>
            </div>
        </div>
    </script>


    <script type="text/javascript">
        $(document).ready(function () {
            //hljs.configure({language: 'JavaScript'});
            $('pre code').each(function (i, block) {
                hljs.highlightBlock(block);
            });

            $('.nav-sidebar > li > a').click(function () {
                var $li = $('.nav-sidebar > li.active');
                $('#' + $li.attr('id') + 'Panel').slideUp('slow');
                $li.removeClass('active');

                $li = $(this).parent();
                $('#' + $li.attr('id') + 'Panel').slideDown('slow');
                $li.addClass('active');
            }); 

            $('.nav-sidebar > li.active > a').trigger('click');
        });
    </script>

    <script type="text/javascript">
        var globalViewModel = {
            indizeList: IndizeList.viewModel
        }

        $(document).ready(function () {
            ko.applyBindings(globalViewModel);
        });


        $(document).on('click', function (e) {
            if ($(e.target).closest(".popover").length == 0) { // click out of the popover 
                $(".popoverShown").popover("hide"); // hide all
            }
        });
  
        ko.bindingHandlers.bsMoney = {
            update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                var value = ko.utils.unwrapObservable(valueAccessor())
                var mode = viewModel.rowDisplayMode()
                var inRow = allBindings.get("inRow");
                var isViewMode = inRow && viewModel.isRowViewMode() || !inRow && viewModel.isViewMode()


                if (isViewMode) {
                    var tokens = value.toFixed(2).replace('-', '').split('.');
                    var s = '$' + $.map(tokens[0].split('').reverse(), function (elm, i) {
                        return [(i % 3 === 0 && i > 0 ? ',' : ''), elm];
                    }).reverse().join('') + '.' + tokens[1];
                    var markup = value < 0 ? '-' + s : s;
                    $(element).html(markup)
                }
                else {
                    if ($(element).find('input').length == 0) {
                        var colName = $(element).data("field");
                        $(element).html("<input style='text-align:right' class='form-control' data-field='" + colName + "' data-bind=\"value: " + colName + "().toFixed(2), valueUpdate:'keyup'\">")
                    }
                }
            }
        }
    </script>

  </body>
</html>