
<style type="text/css">
    body { padding:10px; }
    td { padding:10px; }
</style>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>

<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/default.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>


Knockout CRUD with Bootstrap forms

<br/>
<br/>
<br/>

<a href="SLGen.htm"> <i>SLGen</i> Generator </a>
<br/><br/>

SLGen reads definitions of tables and fields, and generate the javascript classes (js files).<br/>
It uses relation established between tables, and generates appropriate javascript code: classes, templates, widgets ...
<br/><br/>
&nbsp;Person.js => YourEntity.js<br/>
&nbsp;PersonList.js => YourEntityList.js<br/>
&nbsp;PersonDB.js => YourEntityDB.js<br/>
<br/>
Generated classes are ready for upgrading with additional functionality and business logic.</br>
That way there is no javascript code at page (global) level.</br>
Generator will keep user code upon regeneration of classes.
</br>
</br>

<table border=1 cellpadding=0 cellspacing=0 width=90% style='margin-left:10px;'>
<tr>
    <th width=33%><b>Person</b></th>
    <th><b>PersonList</b>
    </th>
    <th><b>PersonDB</b>
    </th>
</tr>

<tr>
    <td><b>Person</b></td>
    <td>
        Keeps ViewModel for Person. <br/><br/>
        Uses module pattern to overcome the limitations of the object literal, 
        offering privacy for variables and functions while exposing a public API.<br/>
        <br/>
    </td>
    <td>Work with Database (storage)<br/>
        Adapter can be in-memory, ajax based, LightStreamer pusher, ...  adapter.  <br/>
    </td>
</tr>

<tr>
    <td>
    
<pre><code class="lang-javascript">    
var <b>Person</b> = function () {
    this.PersonId = ko.observable(data.PersonId || 0)
    this.Name = ko.observable(data.Name || "")

    this.TwitterName = ko.observable(data.TwitterName || "")
    ...
}

Person.prototype.PersonId = ko.observable(0)
    .extend({
        primaryKey: true,
        headerText: "Id",
        formLabel: "Id",
        width: "100px",
        defaultValue: function () { return this.getNextId() }
    });
...

Person.prototype.chosenCity = ko.observable()
        .extend({
            headerText: "City",
            formLabel: "City",
            width: "200px",
            //presentation: "bsDropDownCity"
            presentation: <b style='color:maroon'>"bsTypeaheadCity"</b>
        });
...
</code></pre>        
        
    
    </td>
    <td>

<pre><code class="lang-javascript"> 
var <b>PersonList</b> = (function (DB) {
  
  var StorePerson  = function (data) { 
    db.StorePerson(data) 
  }

  var UpdatePerson = function (data) { 
    db.UpdatePerson(data) 
  }

  var DeletePerson = function (personId) { 
    db.DeletePerson(personId) 
  }

  function GridViewModel() {
    ...
    this.canAdd = ko.computed(function () {
        return this.itemsAtPage().length < PageSize + 1;
    }, this)

    this.add = function () {
    }
    ...
  }
  GridViewModel.prototype = new SLGridViewModel();

  var gridViewModel = new GridViewModel();
  return {
        viewModel: gridViewModel
  }

})(new PersonDB());    
</code></pre>     
    </td>
    
    <td>
<pre><code class="lang-javascript"> 
function <b>PersonDB()</b> {

  this.UpdatePerson = function (data) {
    ...
  }

  this.StorePerson = function (data) {
    ...
  }

  this.DeletePerson = function (id) {
    ...
  }
}    
</code></pre>     
    </td>
    </tr>
     </table>
     
<br />        
<p>
ViewModels of all the entities are being used in global ViewModel like this: <br />
<pre><code class="javascript"> 
    var globalViewModel = {
        personList: PersonList.viewModel,
        cityList: CityList.viewModel
    }

    $(document).ready(function () {
        ko.applyBindings(globalViewModel);
    });
</code></pre>     
</p> 

<p>
Here is the example of <b><i>PersonList</i></b> template.<br />
As in all other cases, if you provide custom template it will be used.<br />
Otherwise default <b><i>EntityListTemplate</i></b> will be used.
<br />

<pre><code class="html"> 
&lt; script type="text/html" id="PersonList"&gt;
        &lt;div style="float:left"&gt;
             &lt;h4&gt;Team&lt;/h4&gt; 
        &lt;/div&gt;

        &lt;div class="form-group" style="float:left;margin:5px;width:200px !important;margin-left:50px;"&gt;
            &lt;div class="input-group iiinput-group-sm"&gt;
                &lt;input id="filterPersonList" type="text" class="form-control input-sm typeahead" style="padding:2px 6px;" /&gt;
                &lt;span class="input-group-addon" style="padding:2px 6px;"&gt;
                    &lt;i id='icon-typeahead' class="fa fa-filter" style="font-size:14px;"&gt;&lt;/i&gt;
                &lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div style="clear:both"&gt;&lt;/div&gt;

        &lt;div style="width:100%"&gt; 
            &lt;div data-bind="SLGrid: $data" /&gt;
            &lt;div&gt;
                &lt;div style="float:left"&gt; 
                    &lt;button class="btn btn-primary" 
                        data-bind="click: addPerson, enable: canAddPerson"&gt;Add Person&lt;/button&gt;
                &lt;/div&gt;
                &lt;div style="float:right;" data-bind="SLGridPager: $data"&gt;
                &lt;/div&gt;
                &lt;div style="float:right; margin-right:20px;"&gt;
                    &lt;span data-bind='text: nItems'&gt;&lt;/span&gt; people&lt;span 
                        data-bind="visible:maxPageIndex()&gt;=itemsOnPager()"&gt;, 
                        &lt;span data-bind='text:maxPageIndex()+1'&gt;&lt;/span&gt; pages&lt;/span&gt;
                &lt;/div&gt;
                &lt;div style="clear:both"&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/script&gt;
</code></pre>  
</p>


<p>
Finally bind PersonTemplate to PersonList.viewModel

<pre><code class="html"> 
    &lt;div class="entity-list person-list" style="width:80%" 
        data-bind="template: {  name: 'PersonList',  
                                data : personList, 
                                afterRender: personList.afterRender }" &gt;
    &lt;/div&gt;
</code></pre>  

</p>


<br/><br/>
We use widgets created by Knockout Custom Bindings.<br/>
Each field can be presenteted in table row, or in Bootstrap form (popover) by different widget.<br/>
See above mentioned widgets: bsDropDownCity or bsTypeheadCity.<br/>

<br/><br/><br/>
<b><i>Example of maintenance of Person table, using generated files for Person entity</i></b> <br/>
<a href="CRUD.htm">Person</a>
<br/><br/><br/>


<script type="text/javascript">
    $(document).ready(function () {
        //hljs.configure({language: 'JavaScript'});
        $('pre code').each(function (i, block) {
            hljs.highlightBlock(block);
        });
    });
</script>
